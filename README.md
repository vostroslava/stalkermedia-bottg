# Stalker Media ‚Äî Telegram Mini App + Bot

Telegram Mini App –¥–ª—è –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤ ¬´–¢–µ—Ä–µ–º–æ–∫¬ª –∏ ¬´–§–æ—Ä–º—É–ª–∞ —É—Å–ø–µ—à–Ω–æ–π –∫–æ–º–∞–Ω–¥—ã¬ª —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ –∫–∞–Ω–∞–ª –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ Google Sheets.

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
- Node.js 18+
- npm 9+
- Telegram Bot Token (—É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω)
- Google Cloud Service Account (–¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ Sheets)

### –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

```bash
# 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
cd /Library/bot-tg-stalkermedia
npm install

# 2. –°–±–æ—Ä–∫–∞ shared –ø–∞–∫–µ—Ç–∞
npm run build -w packages/shared

# 3. –ó–∞–ø—É—Å–∫ –≤ dev —Ä–µ–∂–∏–º–µ (—Å–µ—Ä–≤–µ—Ä + webapp –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ)
npm run dev
```

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ:
- **WebApp**: http://localhost:5173
- **API**: http://localhost:3000/api

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
‚îú‚îÄ‚îÄ apps/
‚îÇ   ‚îú‚îÄ‚îÄ server/          # Express API —Å–µ—Ä–≤–µ—Ä
‚îÇ   ‚îî‚îÄ‚îÄ webapp/          # React Mini App
‚îú‚îÄ‚îÄ packages/
‚îÇ   ‚îî‚îÄ‚îÄ shared/          # –û–±—â–∏–µ —Ç–∏–ø—ã –∏ –ª–æ–≥–∏–∫–∞
‚îú‚îÄ‚îÄ data/
‚îÇ   ‚îú‚îÄ‚îÄ matrix_teremok.json   # –ú–∞—Ç—Ä–∏—Ü–∞ —Ç–µ—Å—Ç–∞ –¢–µ—Ä–µ–º–æ–∫ (21 –≤–æ–ø—Ä–æ—Å)
‚îÇ   ‚îî‚îÄ‚îÄ matrix_formula.json   # –ú–∞—Ç—Ä–∏—Ü–∞ —Ç–µ—Å—Ç–∞ –§–æ—Ä–º—É–ª–∞ (15 –≤–æ–ø—Ä–æ—Å–æ–≤)
‚îú‚îÄ‚îÄ render.yaml          # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–µ–ø–ª–æ—è Render
‚îî‚îÄ‚îÄ package.json         # –ö–æ—Ä–Ω–µ–≤–æ–π package.json (workspaces)
```

## ‚öôÔ∏è –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–∫–æ–ø–∏—Ä—É–π—Ç–µ `.env.example` –≤ `.env` –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ:

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ | –ü—Ä–∏–º–µ—Ä |
|------------|----------|--------|
| `BOT_TOKEN` | –¢–æ–∫–µ–Ω Telegram –±–æ—Ç–∞ | `8219261519:AAE8...` |
| `CHANNEL_ID` | –ö–∞–Ω–∞–ª –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∫–∏ | `@stalker_media_minsk` |
| `GOOGLE_SHEET_ID` | ID Google —Ç–∞–±–ª–∏—Ü—ã | `1abcDEF123...` |
| `GOOGLE_SHEET_TAB` | –ù–∞–∑–≤–∞–Ω–∏–µ –ª–∏—Å—Ç–∞ | `results` |
| `GOOGLE_SERVICE_ACCOUNT_JSON_BASE64` | –ö–ª—é—á —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞ (base64) | `eyJ0eXBlIjoi...` |
| `APP_URL` | URL –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–¥–ª—è production) | `https://app.onrender.com` |
| `PORT` | –ü–æ—Ä—Ç —Å–µ—Ä–≤–µ—Ä–∞ | `3000` |

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

### 1. Telegram Bot

–ë–æ—Ç —É–∂–µ —Å–æ–∑–¥–∞–Ω. –î–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Mini App:

```bash
# –û—Ç–∫—Ä–æ–π—Ç–µ @BotFather –≤ Telegram
# /mybots ‚Üí –í—ã–±–µ—Ä–∏—Ç–µ –±–æ—Ç–∞ ‚Üí Bot Settings ‚Üí Menu Button

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ URL Mini App:
# https://your-app.onrender.com
```

–¢–∞–∫–∂–µ –¥–æ–±–∞–≤—å—Ç–µ –±–æ—Ç–∞ –≤ –∫–∞–Ω–∞–ª `@stalker_media_minsk` –∫–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ (–¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∫–∏).

### 2. Google Sheets

1. –°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–æ–µ–∫—Ç –≤ [Google Cloud Console](https://console.cloud.google.com/)
2. –í–∫–ª—é—á–∏—Ç–µ Google Sheets API
3. –°–æ–∑–¥–∞–π—Ç–µ Service Account –∏ —Å–∫–∞—á–∞–π—Ç–µ JSON –∫–ª—é—á
4. –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–π—Ç–µ –∫–ª—é—á –≤ base64:
   ```bash
   base64 -i service-account.json | tr -d '\n'
   ```
5. –°–æ–∑–¥–∞–π—Ç–µ Google —Ç–∞–±–ª–∏—Ü—É –∏ –¥–∞–π—Ç–µ –¥–æ—Å—Ç—É–ø —Å–µ—Ä–≤–∏—Å–Ω–æ–º—É –∞–∫–∫–∞—É–Ω—Ç—É (email –∏–∑ JSON)
6. –î–æ–±–∞–≤—å—Ç–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –≤ –ø–µ—Ä–≤—É—é —Å—Ç—Ä–æ–∫—É:
   ```
   timestamp | telegram_id | telegram_username | phone | test_code | result_type | result_title
   ```

### 3. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –±–æ—Ç–∞ –≤ –∫–∞–Ω–∞–ª

1. –û—Ç–∫—Ä–æ–π—Ç–µ –∫–∞–Ω–∞–ª `@stalker_media_minsk`
2. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ ‚Üí –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã
3. –î–æ–±–∞–≤—å—Ç–µ –±–æ—Ç–∞ –∏ –¥–∞–π—Ç–µ –ø—Ä–∞–≤–∞ –Ω–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤

## üåê –î–µ–ø–ª–æ–π –Ω–∞ Render

### –ß–µ—Ä–µ–∑ render.yaml

1. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∫ Render
2. Render –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥—Ö–≤–∞—Ç–∏—Ç `render.yaml`
3. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö —Å–µ—Ä–≤–∏—Å–∞

### –†—É—á–Ω–æ–π –¥–µ–ø–ª–æ–π

```bash
# Build
npm ci
npm run build

# Start
npm run start
```

### –ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è

1. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ URL –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
2. –û—Ç–∫—Ä–æ–π—Ç–µ @BotFather ‚Üí /mybots
3. Bot Settings ‚Üí Menu Button ‚Üí Edit Menu Button URL
4. –í—Å—Ç–∞–≤—å—Ç–µ URL

## üì° API Endpoints

| –ú–µ—Ç–æ–¥ | –ü—É—Ç—å | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|------|----------|
| GET | `/api/health` | Health check |
| GET | `/api/tests` | –°–ø–∏—Å–æ–∫ —Ç–µ—Å—Ç–æ–≤ |
| GET | `/api/tests/:code` | –ú–∞—Ç—Ä–∏—Ü–∞ —Ç–µ—Å—Ç–∞ |
| GET | `/api/subscription/check` | –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏ |
| POST | `/api/results` | –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ |

## üß™ –¢–µ—Å—Ç—ã

```bash
# Unit —Ç–µ—Å—Ç—ã (shared)
npm run test:unit

# API —Ç–µ—Å—Ç—ã (server)
npm run test:api

# –í—Å–µ —Ç–µ—Å—Ç—ã
npm test
```

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –í—Å–µ API –∑–∞–ø—Ä–æ—Å—ã –≤–∞–ª–∏–¥–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ Telegram initData (HMAC-SHA256)
- –í production —Ä–µ–∂–∏–º–µ CORS –æ–≥—Ä–∞–Ω–∏—á–µ–Ω –¥–æ–º–µ–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- –°–µ—Ä–≤–∏—Å–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç Google –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –∫ –æ–¥–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ

## üìù –õ–∏—Ü–µ–Ω–∑–∏—è

–ü—Ä–æ–ø—Ä–∏–µ—Ç–∞—Ä–Ω—ã–π –∫–æ–¥ ¬© –°—Ç–∞–ª–∫–µ—Ä –ú–µ–¥–∏–∞
